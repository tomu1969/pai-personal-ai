# Evolution API Configuration
# This file contains all settings for Evolution API v2

# ===============================
# SERVER CONFIGURATION
# ===============================
SERVER_TYPE=http
SERVER_PORT=8080
SERVER_URL=http://localhost:8080

# ===============================
# DATABASE CONFIGURATION
# PostgreSQL runs locally in Docker - no external account needed
# ===============================
DATABASE_PROVIDER=postgresql
DATABASE_CONNECTION_URI=postgresql://evolution:mypassword123@localhost:5432/evolution_db?schema=public
DATABASE_CONNECTION_CLIENT_NAME=evolution_api

# Save data settings
DATABASE_SAVE_DATA_INSTANCE=true
DATABASE_SAVE_DATA_NEW_MESSAGE=true
DATABASE_SAVE_MESSAGE_UPDATE=true
DATABASE_SAVE_DATA_CONTACTS=true
DATABASE_SAVE_DATA_CHATS=true
DATABASE_SAVE_DATA_LABELS=true
DATABASE_SAVE_DATA_HISTORIC=true

# ===============================
# AUTHENTICATION
# This is YOUR API key - you choose it
# ===============================
AUTHENTICATION_API_KEY=pai_evolution_api_key_2025
AUTHENTICATION_TYPE=apikey
AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES=true

# ===============================
# REDIS CACHE
# ===============================
CACHE_REDIS_ENABLED=true
CACHE_REDIS_URI=redis://localhost:6379
CACHE_REDIS_PREFIX_KEY=evolution

# ===============================
# WEBHOOK CONFIGURATION
# Connects to your AI PBX running on localhost:3000
# ===============================
WEBHOOK_GLOBAL_ENABLED=true
WEBHOOK_GLOBAL_URL=http://host.docker.internal:3000/webhook
WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS=true

# ===============================
# RETRY MECHANISM (IMPROVE RELIABILITY)
# ===============================
WEBHOOK_REQUEST_TIMEOUT_MS=60000
WEBHOOK_RETRY_MAX_ATTEMPTS=5
WEBHOOK_RETRY_INITIAL_DELAY_SECONDS=2
WEBHOOK_RETRY_MAX_DELAY_SECONDS=30
WEBHOOK_RETRY_USE_EXPONENTIAL_BACKOFF=true
WEBHOOK_RETRY_JITTER_FACTOR=0.2
WEBHOOK_RETRY_NON_RETRYABLE_STATUS_CODES=400,401,403,404,422

# Events to send to webhook
WEBHOOK_EVENTS_APPLICATION_STARTUP=false
WEBHOOK_EVENTS_QRCODE_UPDATED=true
WEBHOOK_EVENTS_MESSAGES_SET=true
WEBHOOK_EVENTS_MESSAGES_UPSERT=true
WEBHOOK_EVENTS_MESSAGES_EDITED=true
WEBHOOK_EVENTS_MESSAGES_UPDATE=true
WEBHOOK_EVENTS_MESSAGES_DELETE=true
WEBHOOK_EVENTS_SEND_MESSAGE=true
WEBHOOK_EVENTS_CONTACTS_SET=true
WEBHOOK_EVENTS_CONTACTS_UPSERT=true
WEBHOOK_EVENTS_CONTACTS_UPDATE=true
WEBHOOK_EVENTS_PRESENCE_UPDATE=true
WEBHOOK_EVENTS_CHATS_SET=true
WEBHOOK_EVENTS_CHATS_UPSERT=true
WEBHOOK_EVENTS_CHATS_UPDATE=true
WEBHOOK_EVENTS_CHATS_DELETE=true
WEBHOOK_EVENTS_GROUPS_UPSERT=true
WEBHOOK_EVENTS_GROUPS_UPDATE=true
WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE=true
WEBHOOK_EVENTS_CONNECTION_UPDATE=true
WEBHOOK_EVENTS_CALL=true
WEBHOOK_EVENTS_TYPEBOT_START=false
WEBHOOK_EVENTS_TYPEBOT_CHANGE_STATUS=false

# ===============================
# CORS CONFIGURATION
# ===============================
CORS_ORIGIN=*
CORS_METHODS=POST,GET,PUT,DELETE
CORS_CREDENTIALS=true

# ===============================
# LOG CONFIGURATION
# ===============================
LOG_LEVEL=ERROR,WARN,INFO
LOG_COLOR=true
LOG_BAILEYS=error

# ===============================
# INSTANCE CONFIGURATION
# ===============================
CONFIG_SESSION_PHONE_CLIENT=AI-PBX
CONFIG_SESSION_PHONE_NAME=AI PBX Assistant
# Fix for QR code generation issue - leave blank or use specific version
CONFIG_SESSION_PHONE_VERSION=2.2416.9
# Prevent automatic instance deletion
DEL_INSTANCE=false

# ===============================
# QRCODE CONFIGURATION
# ===============================
QRCODE_LIMIT=30
QRCODE_COLOR=#25D366

# ===============================
# MESSAGE SETTINGS
# ===============================
SEND_NO_EXIST=false
CLEAN_STORE_CLEANING_INTERVAL=7200
CLEAN_STORE_MESSAGE=true
CLEAN_STORE_MESSAGE_DAYS=30
CLEAN_STORE_CHAT=true
CLEAN_STORE_CHAT_DAYS=30
CLEAN_STORE_CONTACT=true
CLEAN_STORE_CONTACT_DAYS=30